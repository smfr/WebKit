<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <script src=../../media-resources/video-test.js></script>
        <script src=../../media-resources/media-file.js></script>

        <script>
            var track;

            function addtrack(event)
            {
                tracks = event.target;
                run("track = video.textTracks[0]");
                testExpected("track.kind", "metadata");
                run("track.mode = 'hidden'");
                waitForEvent('cuechange', cuechange, false, true, track);
            }

            function cuechange()
            {
                consoleWrite("<br>Create a VTTCue and add it to the InbandDataTextTrack.");
                run("cueCountBefore = track.cues.length");
                run("vttCue = new VTTCue(0, 1, 'test')");
                run("track.addCue(vttCue)");
                testExpected("track.cues.length == cueCountBefore + 1", true);

                consoleWrite("<br>Remove the VTTCue from the InbandDataTextTrack, should not crash.");
                run("track.removeCue(vttCue)");
                testExpected("track.cues.length == cueCountBefore", true);

                consoleWrite("");
                endTest();
            }

            function start()
            {
                consoleWrite("<br>Set video.src, wait for metadata track to be added.");
                findMediaElement();

                waitForEvent('addtrack', addtrack, false, true, video.textTracks);

                video.oncanplaythrough = () => { video.removeAttribute('oncanplaythrough'); video.play() };

                run("video.src = 'http://127.0.0.1:8000/media/resources/hls/metadata/prog_index.m3u8'");

                consoleWrite("");
            }
        </script>
    </head>
    <body onload="start()">
        <video controls></video>
        <p>Test that removing a non-DataCue (VTTCue) from an InbandDataTextTrack does not crash.</p>
    </body>
</html>
